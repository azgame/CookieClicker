<!DOCTYPE html>

<link rel="stylesheet" type="text/css" href="SemanticUI/dist/semantic.min.css">
    <script
    src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>
    <script src="SemanticUI/dist/semantic.min.js"></script>

<html>
<head>
	<title>UI Example</title>
</head>
<body>

    <script>
      var count = 0;
    </script>

    <div>
      <p id="Steel">0</p>
      <p id="Wood">0</p>
      <p id="Food">0</p>
    </div>
    <div class="ui three buttons">
        <button class="ui button", id="SteelButton">
            Steel
          </button>
          <button class="ui button", id="WoodButton">
            Wood
          </button>
          <button class="ui button", id="FoodButton">
            Food
          </button>
    </div>

    <script>

      class SoulHolder
      {
          constructor() 
          { 
              this.currencies = {}; 

              this.UpdateCurrency("Steel", 20);
              this.UpdateCurrency("Wood", 20);
              this.UpdateCurrency("Food", 30);

              this.rates = {};
          }

          HasCurrency(Key)
          {
              return Key in this.currencies;
          }

          HasRate(Key)
          {
              return Key in this.rates;
          }

          AddCurrency(Key)
          {
              this.currencies[Key] = 0;
          };

          UpdateCurrency(Key, Value)
          {
              if (!this.HasCurrency(Key))
              {
                  this.currencies[Key] = 0;
              }

              this.currencies[Key] += Value;
          };

          UpdateRate(Key, Rate)
          {
              if (!this.HasRate(Key))
              {
                  this.rates[Key] = 0;
              }

              this.rates[Key] += Rate;
          }

          Buy(Key, Building)
          {
              this.UpdateRate(Key, Building.GetRate());
              this.UpdateCurrency(Building.GetCurrency(), -Building.GetCost());
          }

          Update()
          {
              for (const[key, value] of Object.entries(this.rates))
              {
                  this.UpdateCurrency(key, value);
              }
          }
      }

      class Builder
      {
          constructor(Name, Cost, Rate, Currency)
          {
              this.cost = Cost;
              this.name = Name;
              this.rate = Rate;
              this.currency = Currency;
          }

          CanBuy(SoulHolder)
          {
              if (SoulHolder.currencies[this.currency] > this.cost)
                return true;
          }

          Buy()
          {
              this.cost = this.cost * 1.5;
          }

          GetCost() 
          {
              return this.cost;
          }

          GetCurrency()
          {
              return this.currency;
          }

          GetRate()
          {
              return this.rate;
          }
      }

      class BuildingRegistry
      {
          constructor()
          {
              this.buildings = {};

              var steel = new Builder("Steel", 5, 0.01, "Steel");
              this.buildings["Steel"] = steel;

              var steel = new Builder("Wood", 5, 0.01, "Wood");
              this.buildings["Wood"] = steel;

              var steel = new Builder("Food", 5, 0.01, "Food");
              this.buildings["Food"] = steel;
          }

          AddBuilding(Building)
          {
              this.buildings[Building.name] = Building;
          }

          Buy(Key, SoulHolder)
          {
              if (this.buildings[Key].CanBuy(SoulHolder))
              {
                  SoulHolder.Buy(Key, this.buildings[Key]);
                  this.buildings[Key].Buy();
              }
          }
      }

      let registry = new BuildingRegistry();
      let player = new SoulHolder();

      document.getElementById("SteelButton").addEventListener("click", function()
      { 
          registry.Buy("Steel", player);
      });

      document.getElementById("WoodButton").addEventListener("click", function()
      { 
          registry.Buy("Wood", player);
      });

      document.getElementById("FoodButton").addEventListener("click", function()
      { 
          registry.Buy("Food", player);
      });

      function display(Player)
      {
          var key = "Steel";
          document.getElementById(key).innerHTML = key + " " + Math.floor(Player.currencies[key]); 

          key = "Wood";
          document.getElementById(key).innerHTML = key + " " + Math.floor(Player.currencies[key]); 

          key = "Food";
          document.getElementById(key).innerHTML = key + " " + Math.floor(Player.currencies[key]); 
      }

      function frame()
      {

          player.Update();

          display(player);

          window.requestAnimationFrame(frame);
      }

      frame();

    </script>
</body>
</html>