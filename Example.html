<!DOCTYPE html>

<link rel="stylesheet" type="text/css" href="SemanticUI/dist/semantic.min.css">
    <script
    src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>
    <script src="SemanticUI/dist/semantic.min.js"></script>
    <script src="SemanticUI/src/definitions/behaviors/api.js"></script>
    <script src="SemanticUI/src/definitions/modules/popup.js"></script>

<html>
<head>
	<title>UI Example</title>
</head>
<body>

    <div>
      <p id="Steel">0</p>
      <p id="Wood">0</p>
      <p id="Food">0</p>
    </div>
    <div class="ui three buttons">
        <button class="ui button", id="SteelButton">
            Steel
          </button>
          <button class="ui button", id="WoodButton">
            Wood
          </button>
          <button class="ui button", id="FoodButton">
            Food
          </button>
          
    </div>

    <div class="ui button", id="PopupButton">Show event</div>
        <div class="ui popup top left transition hidden">
            <h4 class="ui header">Event!</h4>
            <p><b>2</b> DiegoSouls</p>
            <div class="ui button">Buy</div>
    </div>

    <script>

    $(document.getElementById("PopupButton"))
        .popup({
            on : "hover",
            hoverable : true
        })
    ;

      class SoulHolder
      {
          constructor() 
          { 
              this.currencies = {}; 

              this.UpdateCurrency("Steel", 20);
              this.UpdateCurrency("Wood", 20);
              this.UpdateCurrency("Food", 30);

              this.rates = {};
          }

          HasCurrency(Key)
          {
              return Key in this.currencies;
          }

          HasRate(Key)
          {
              return Key in this.rates;
          }

          AddCurrency(Key)
          {
              this.currencies[Key] = 0;
          };

          UpdateCurrency(Key, Value)
          {
              if (!this.HasCurrency(Key))
              {
                  this.currencies[Key] = 0;
              }

              this.currencies[Key] += Value;
          };

          UpdateRate(Key, Rate)
          {
              if (!this.HasRate(Key))
              {
                  this.rates[Key] = 0;
              }

              this.rates[Key] += Rate;
          }

          Buy(Building)
          {
              this.UpdateRate(Building.GetCurrencyGet(), Building.GetRate());
              this.UpdateCurrency(Building.GetCurrencyBuy(), -Building.GetCost());
          }

          Update()
          {
              for (const[key, value] of Object.entries(this.rates))
              {
                  this.UpdateCurrency(key, value);
              }
          }
      }

      class Builder
      {
          constructor(Name, CurrencyCost, Cost, CurrencyGet, Rate)
          {
            this.name = Name;
            this.currencyCost = CurrencyCost;
            this.cost = Cost;
            this.currencyGet = CurrencyGet;
            this.rate = Rate;
          }

          GetName()
          {
              return this.name;
          }

          CanBuy(SoulHolder)
          {
              if (SoulHolder.currencies[this.currencyCost] > this.cost)
                return true;
          }

          Buy()
          {
              this.cost = this.cost * 1.5;
          }

          GetCost() 
          {
              return this.cost;
          }

          GetCurrencyBuy()
          {
              return this.currencyCost;
          }

          GetCurrencyGet()
          {
              return this.currencyGet;
          }

          GetRate()
          {
              return this.rate;
          }
      }

      class BuildingRegistry
      {
          constructor()
          {
              this.buildings = {};

              var steel = new Builder("SteelBuilding", "Wood", 5, "Steel", 0.01);
              this.AddBuilding(steel);

              var wood = new Builder("WoodBuilding", "Food", 5, "Wood", 0.01);
              this.AddBuilding(wood);

              var food = new Builder("FoodBuilding", "Steel", 5, "Food", 0.01);
              this.AddBuilding(food);
          }

          AddBuilding(Building)
          {
              this.buildings[Building.GetName()] = Building;
          }

          Buy(Key, SoulHolder)
          {
              if (this.buildings[Key].CanBuy(SoulHolder))
              {
                  SoulHolder.Buy(this.buildings[Key]);
                  this.buildings[Key].Buy();
              }
          }
      }

      let registry = new BuildingRegistry();
      let player = new SoulHolder();

      document.getElementById("SteelButton").addEventListener("click", function()
      { 
          registry.Buy("SteelBuilding", player);
      });

      document.getElementById("WoodButton").addEventListener("click", function()
      { 
          registry.Buy("WoodBuilding", player);
      });

      document.getElementById("FoodButton").addEventListener("click", function()
      { 
          registry.Buy("FoodBuilding", player);
      });

      

      function display(Player)
      {
          var key = "Steel";
          document.getElementById(key).innerHTML = key + " " + Math.floor(Player.currencies[key]); 

          key = "Wood";
          document.getElementById(key).innerHTML = key + " " + Math.floor(Player.currencies[key]); 

          key = "Food";
          document.getElementById(key).innerHTML = key + " " + Math.floor(Player.currencies[key]); 
      }

      function frame()
      {

          player.Update();

          display(player);

          window.requestAnimationFrame(frame);
      }

      frame();

    </script>
</body>
</html>