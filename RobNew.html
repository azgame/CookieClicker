<!DOCTYPE html>

<link rel="stylesheet" type="text/css" href="SemanticUI/dist/semantic.min.css">
    <script
    src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>
    <script src="SemanticUI/dist/semantic.min.js"></script>
    <script src="SemanticUI/src/definitions/behaviors/api.js"></script>
    <script src="SemanticUI/src/definitions/modules/popup.js"></script>

<html>
<head>
	<title>UI Example</title>
</head>
<body>

    <div>
      <p id="basic">0</p>
      <p id="juju">0</p>
      <p id="diego">0</p>
      <p id="bingo">0</p>
      <p id="sole">0</p>
      <p id="super">0</p>
      <p id="superDeDuper">0</p>
    </div>
    <div>
      <p id="basicRate">0</p>
      <p id="jujuRate">0</p>
      <p id="diegoRate">0</p>
      <p id="bingoRate">0</p>
      <p id="soleRate">0</p>
      <p id="superRate">0</p>
      <p id="superDeDuperRate">0</p>
    </div>
    <div class="ui seven buttons">
      <button class="ui button", id="ghostHelperButton">
          GhostHelper
        </button>
        <button class="ui button", id="graveStoneButton">
            GraveStone
          </button>
          <button class="ui button", id="graveyardButton">
            Graveyard
          </button>
          <button class="ui button", id="cemetaryButton">
            Cemetary
          </button>
          <button class="ui button", id="battlefieldButton">
            Battlefield
          </button>
          <button class="ui button", id="ghoulaPaloozaButton">
            Ghoula-palooza
          </button>
          <button class="ui button", id="skeletonBoneanzaButton">
            Skeleton-Boneanza
          </button>

    </div>
    <button class="ui button", id="mashButton">
        Mash
      </button>
    <div class="ui button", id="PopupButton">Show event</div>
        <div class="ui popup top left transition hidden">
            <h4 class="ui header">Event!</h4>
            <p><b>2</b> DiegoSouls</p>
            <div class="ui button">Buy</div>
    </div>

    <script>

    $(document.getElementById("PopupButton"))
        .popup({
            on : "hover",
            hoverable : true
        })
    ;

      class SoulHolder
      {
          constructor()
          {
              this.currencies = {};
              this.UpdateCurrency("basic", 20);
              this.UpdateCurrency("juju", 0);
              this.UpdateCurrency("diego", 0);
              this.UpdateCurrency("bingo", 0);
              this.UpdateCurrency("sole", 0);
              this.UpdateCurrency("super", 0);
              this.UpdateCurrency("superDeDuper", 0);


              this.rates = {};
          }

          HasCurrency(Key)
          {
              return Key in this.currencies;
          }

          HasRate(Key)
          {
              return Key in this.rates;
          }
          GetRate(name)
          {
            return this.rates[name];
          }
          AddCurrency(Key)
          {
              this.currencies[Key] = 0;
          };

          UpdateCurrency(Key, Value)
          {
              if (!this.HasCurrency(Key))
              {
                  this.currencies[Key] = 0;
              }

              this.currencies[Key] += Value;
          };

          UpdateRate(Key, Rate)
          {
              if (!this.HasRate(Key))
              {
                  this.rates[Key] = 0;
              }

              this.rates[Key] += Rate;
          }

          Buy(Building)
          {
              this.UpdateRate(Building.GetCurrencyGet(), Building.GetRate());
              this.UpdateCurrency(Building.GetCurrencyBuy(), -Building.GetCost());
          }

          Update()
          {
              for (const[key, value] of Object.entries(this.rates))
              {
                  this.UpdateCurrency(key, value);
              }
          }
      }

      class Builder
      {
          constructor(Name, CurrencyCost, Cost, CurrencyGet, Rate)
          {
            this.name = Name;
            this.currencyCost = CurrencyCost;
            this.cost = Cost;
            this.currencyGet = CurrencyGet;
            this.rate = Rate;
          }

          GetName()
          {
              return this.name;
          }

          CanBuy(SoulHolder)
          {
              if (SoulHolder.currencies[this.currencyCost] > this.cost)
                return true;
          }

          Buy()
          {
              this.cost = this.cost * 1.1;
          }

          GetCost()
          {
              return this.cost;
          }

          GetCurrencyBuy()
          {
              return this.currencyCost;
          }

          GetCurrencyGet()
          {
              return this.currencyGet;
          }

          GetRate()
          {
              return this.rate;
          }
      }

      class BuildingRegistry
      {
          constructor()
          {
              this.buildings = {};

              var ghostHelper = new Builder("ghostHelperBuilding", "basic", 50, "basic", 0.03);
              this.AddBuilding(ghostHelper);
              var graveStone = new Builder("graveStoneBuilding", "basic", 50, "juju", 0.03);
              this.AddBuilding(graveStone);

              var graveYard = new Builder("graveYardBuilding", "juju", 200, "diego", 0.15);
              this.AddBuilding(graveYard);

              var cemetary = new Builder("cemetaryBuilding", "diego", 500, "bingo", 0.45);
              this.AddBuilding(cemetary);
              var battlefield = new Builder("battlefieldBuilding", "bingo", 1500, "sole", 1.5);
              this.AddBuilding(battlefield);
              var ghoulapalooza = new Builder("ghoulapaloozaBuilding", "sole", 5000, "super", 5.4);
              this.AddBuilding(ghoulapalooza);
              var skeletonboneanza = new Builder("skeletonboneanzaBuilding", "super", 10000, "superDeDuper", 9);
              this.AddBuilding(skeletonboneanza);
          }

          AddBuilding(Building)
          {
              this.buildings[Building.GetName()] = Building;
          }

          Buy(Key, SoulHolder)
          {
              if (this.buildings[Key].CanBuy(SoulHolder))
              {
                  SoulHolder.Buy(this.buildings[Key]);
                  this.buildings[Key].Buy();
              }
          }
          GetBuilding(name)
          {
            return   this.buildings[name];
          }
      }

      let registry = new BuildingRegistry();
      let player = new SoulHolder();

      document.getElementById("ghostHelperButton").addEventListener("click", function()
      {
          registry.Buy("ghostHelperBuilding", player);
          document.getElementById("ghostHelperButton").innerHTML = "GraveStone Cost: " + registry.GetBuilding("ghostHelperBuilding").GetCost();
            document.getElementById("basicRate").innerHTML = "basic souls per sec: " + player.GetRate("basic");
      });
      document.getElementById("graveStoneButton").addEventListener("click", function()
      {
          registry.Buy("graveStoneBuilding", player);
          document.getElementById("graveStoneButton").innerHTML = "GraveStone Cost: " + registry.GetBuilding("graveStoneBuilding").GetCost();
          document.getElementById("jujuRate").innerHTML = "juju souls per sec: " + player.GetRate("juju");
      });

      document.getElementById("graveyardButton").addEventListener("click", function()
      {
          registry.Buy("graveYardBuilding", player);
          document.getElementById("graveyardButton").innerHTML = "GraveYard Cost: " + registry.GetBuilding("graveYardBuilding").GetCost();
          document.getElementById("diegoRate").innerHTML = "digeo souls per sec: " + player.GetRate("diego");
      });

      document.getElementById("cemetaryButton").addEventListener("click", function()
      {
          registry.Buy("cemetaryBuilding", player);
          document.getElementById("cemetaryButton").innerHTML = "Cemetary Cost: " + registry.GetBuilding("cemetaryBuilding").GetCost();
          document.getElementById("bingoRate").innerHTML = "bingo souls per sec: " + player.GetRate("bingo");
      });
      document.getElementById("battlefieldButton").addEventListener("click", function()
      {
          registry.Buy("battlefieldBuilding", player);
          document.getElementById("battlefieldButton").innerHTML = "Battlefield Cost: " + registry.GetBuilding("battlefieldBuilding").GetCost();
          document.getElementById("soleRate").innerHTML = "sole souls per sec: " + player.GetRate("sole");
      });
      document.getElementById("ghoulaPaloozaButton").addEventListener("click", function()
      {
          registry.Buy("ghoulapaloozaBuilding", player);
          document.getElementById("ghoulaPaloozaButton").innerHTML = "Ghoula-Palooza Cost: " + registry.GetBuilding("ghoulapaloozaBuilding").GetCost();
          document.getElementById("superRate").innerHTML = "Super souls per sec: " + player.GetRate("super");
      });
      document.getElementById("skeletonBoneanzaButton").addEventListener("click", function()
      {
          registry.Buy("skeletonboneanzaBuilding", player);
          document.getElementById("skeletonBoneanzaButton").innerHTML = "Ghoula-Palooza Cost: " + registry.GetBuilding("skeletonboneanzaBuilding").GetCost();
          document.getElementById("superDeDuperRate").innerHTML = "Super-De-Duper souls per sec: " + player.GetRate("superDeDuper");
      });
      document.getElementById("mashButton").addEventListener("click", function()
      {
          player.UpdateCurrency("basic", 2);
      });




      function display(Player)
      {
          var key = "basic";
          document.getElementById(key).innerHTML = key + " Souls " + Math.floor(Player.currencies[key]);

          key = "juju";
          document.getElementById(key).innerHTML = key + " Souls " + Math.floor(Player.currencies[key]);

          key = "diego";
          document.getElementById(key).innerHTML = key + " Souls " + Math.floor(Player.currencies[key]);

          key = "bingo";
          document.getElementById(key).innerHTML = key + " Souls " + Math.floor(Player.currencies[key]);

          key = "sole";
          document.getElementById(key).innerHTML = key + " Souls " + Math.floor(Player.currencies[key]);

          key = "super";
          document.getElementById(key).innerHTML = key + " Souls " + Math.floor(Player.currencies[key]);

          key = "superDeDuper";
          document.getElementById(key).innerHTML = key + " Souls " + Math.floor(Player.currencies[key]);
      }

      function frame()
      {

          player.Update();

          display(player);

          window.requestAnimationFrame(frame);
      }

      frame();

    </script>
</body>
</html>
